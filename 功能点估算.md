## 1. 系统抽象

![](./images/系统抽象图.png)

## 2. 功能点分析

使用IFPUG方法进行功能点估算。

#### ILF, EIF分析

系统的内部逻辑文件(ILF)、外部逻辑文件(EIF)及其字段如下表:

| key-value数据存储                                            | 一致性哈希环                                                 | 分布式节点信息                                       | 系统统计数据                                                 | 主从节点信息                                                 |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ---------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| DataStorage<br>1. 数据key<br>2. 数据entry类型<br>3. 原始数据内容<br>KeysManager<br>1. 数据key | Hash Ring<br>1. Peer名称<br>2. Peer http通讯地址<br>3. Peer socket通讯地址<br>4. Replicas数量 | Nodes<br>1. Node名称<br>2. Node地址<br>3. Node连通性 | Stats<br>1. 系统启动时间<br>2. 系统内存使用量<br>3. 系统存储key数量<br>4. 系统操作执行数 | Master-Slave<br>1. Master名称<br>2. Master地址<br>3. Slave名称<br>4. Slave地址 |

使用ILF/EIF复杂度矩阵如下：

|            | 1~19个DET | 20~50个DET | 超过51个DET |
| ---------- | --------- | ---------- | ----------- |
| 1个RET     | 低        | 低         | 中等        |
| 2~5个RET   | 低        | 中等       | 高          |
| 6个以上RET | 中等      | 高         | 高          |

使用的ILF、EIF等价功能点取值标准：

| 复杂度 | 1~19个DET | 20~50个DET | 高   |
| ------ | --------- | ---------- | ---- |
| ILF数  | 7         | 10         | 15   |
| EIF数  | 5         | 7          | 10   |

识别出的ILF和EIF功能点个数如下:

| ILF内部逻辑文件    | RET  | DET  | 复杂度 | 未调整的FP个数 |
| ------------------ | ---- | ---- | ------ | -------------- |
| Key-values数据存储 | 2    | 4    | 低     | 7              |
| 一致性哈希环       | 1    | 4    | 低     | 7              |
| 分布式节点信息     | 1    | 3    | 低     | 7              |
| 系统统计数据       | 1    | 4    | 低     | 7              |
| 主从节点信息       | 1    | 4    | 低     | 7              |
| EIF外部逻辑文件    | RET  | DET  | 复杂度 |                |
| 无                 | 0    | 0    |        | 0              |

由此，数据功能点个数 DFP=ILF+EIF=35。

#### EI, EO, EQ分析

##### EI分析

使用的EI复杂度计算矩阵：

|            | 1~4个DET | 4~15个DET | 超过15个DET |
| ---------- | -------- | --------- | ----------- |
| 0~1个FTR   | 低       | 低        | 中等        |
| 2个FTR     | 低       | 中等      | 高          |
| 3个以上FTR | 中等     | 高        | 高          |

EI等价功能点取值标准：

| EI复杂度 | 低   | 中等 | 高   |
| -------- | ---- | ---- | ---- |
| 功能点数 | 3    | 4    | 6    |

识别出的EI个数如下表所示:

| EI                       | FTR  | DET个数 | 复杂度 | 未调整的FP个数 |
| ------------------------ | ---- | ------- | ------ | -------------- |
| 存储字符串类型数据       | 3    | 6       | 高     | 6              |
| 存储列表类型数据         | 3    | 6       | 高     | 6              |
| 存储集合类型数据         | 3    | 6       | 高     | 6              |
| 存储哈希表类型数据       | 3    | 6       | 高     | 6              |
| 追加列表类型数据         | 3    | 6       | 高     | 6              |
| 追加集合类型数据         | 3    | 6       | 高     | 6              |
| 追加哈希表类型数据       | 3    | 6       | 高     | 6              |
| 删除字符串类型数据       | 3    | 6       | 高     | 6              |
| 删除列表类型数据         | 3    | 6       | 高     | 6              |
| 删除集合类型数据         | 3    | 6       | 高     | 6              |
| 删除哈希表类型数据       | 3    | 6       | 高     | 6              |
| 增加分布式节点           | 3    | 9       | 高     | 6              |
| 删除分布式节点           | 3    | 9       | 高     | 6              |
| 增加从属节点             | 1    | 4       | 低     | 3              |
| 删除从属节点             | 1    | 4       | 低     | 3              |
| 设置一致性哈希环重复系数 | 1    | 3       | 低     | 3              |

##### EO分析

使用的EO复杂度计算矩阵：

|            | 1~5个DET | 6~19个DET | 超过19个DET |
| ---------- | -------- | --------- | ----------- |
| 0~1个FTR   | 低       | 低        | 中等        |
| 2~3个FTR   | 低       | 中等      | 高          |
| 4个以上FTR | 中等     | 高        | 高          |

EI等价功能点取值标准：

| EI复杂度 | 低   | 中等 | 高   |
| -------- | ---- | ---- | ---- |
| 功能点数 | 4    | 5    | 7    |

识别出的EO个数如下表所示:

| EO                   | FTR  | DET个数 | 复杂度 | 未调整的FP个数 |
| -------------------- | ---- | ------- | ------ | -------------- |
| 查询列表长度         | 2    | 5       | 低     | 4              |
| 查询指定范围列表内容 | 2    | 5       | 低     | 4              |
| 查询字符串长度       | 2    | 5       | 低     | 4              |
| 查询集合大小         | 2    | 5       | 低     | 4              |
| 查询哈希表大小       | 2    | 5       | 低     | 4              |
| 求集合交集           | 2    | 5       | 低     | 4              |
| 求集合并集           | 2    | 5       | 低     | 4              |

##### EQ分析

使用的EQ复杂度计算矩阵：

|            | 1~5个DET | 6~19个DET | 超过19个DET |
| ---------- | -------- | --------- | ----------- |
| 0~1个FTR   | 低       | 低        | 中等        |
| 2~3个FTR   | 低       | 中等      | 高          |
| 4个以上FTR | 中等     | 高        | 高          |

EI等价功能点取值标准：

| EI复杂度 | 低   | 中等 | 高   |
| -------- | ---- | ---- | ---- |
| 功能点数 | 4    | 5    | 7    |

识别出的EQ个数如下表所示:

| EQ                         | FTR  | DET个数 | 复杂度 | 未调整的FP个数 |
| -------------------------- | ---- | ------- | ------ | -------------- |
| 查询key是否存在            | 2    | 3       | 低     | 4              |
| 查询字符串数据内容         | 2    | 5       | 低     | 4              |
| 查询列表数据内容           | 2    | 5       | 低     | 4              |
| 查询集合数据内容           | 2    | 5       | 低     | 4              |
| 查询哈希表数据内容         | 2    | 5       | 低     | 4              |
| 查询某数据数据内容         | 2    | 5       | 低     | 4              |
| 查询某数据是否存在列表中   | 2    | 5       | 低     | 4              |
| 查询某数据是否存在集合中   | 2    | 5       | 低     | 4              |
| 查询某数据是否存在哈希表中 | 2    | 5       | 低     | 4              |
| 查询统计数据摘要           | 2    | 6       | 中     | 5              |
| 查询分布式节点信息         | 2    | 6       | 中     | 5              |
| 查询主从节点信息           | 2    | 4       | 低     | 4              |

由此，事务功能点个数 TFP = EI + EO + EQ = 87 + 28 + 50 = 165 个。 

所以，未调整的功能点 UFP=DFP+TFP=35+165=198个。

进一步考虑，本系统的系统特性及影响程度如下:



| 系统特性       | 分数 |
| -------------- | ---- |
| 数据通讯       | 5 |
| 分布式数据处理 | 4 |
| 性能           | 5 |
| 大业务量配置   | 5 |
| 事务处理率     | 4  |
| 在线数据输入   | 5   |
| 最终用户效率   | 4    |
| 在线更新       | 4   |
| 复杂处理                | 4   |
| 可复用性                | 5   |
| 易安装性                | 0    |
| 易操作性                | 4   |
| 多场地                  | 3    |
| 支持变更                | 2   |
| 合计:54 |      |
| 调整因子:0.65+0.01*54=1.19 |      |

由此，调整后的功能点 AFP=UFP*1.19=235.62
根据日本IPA SEC 组织(http://sec.ipa.go.jp/)所提供的工作量估算共识: Effort=e^0.542*FP^1.154= 939.55人/天 假设日标准工作时间为8小时，工作量估计为 7516.4人/小时。